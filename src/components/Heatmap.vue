<template>
  <div class="HeatMap">
    <vue-plotly class="" :data="data" :layout="layout" :options="options" @click="triggerClick"/>
  </div>
</template>

<script>
import VuePlotly from '@statnett/vue-plotly';

let location_map = new Map();
location_map.set("Brew've Been Served",0);
location_map.set("Hallowed Grounds",1);
location_map.set("Hippokampos",2);
location_map.set("Kalami Kafenion",3);
location_map.set("Katerina CafÃ¨",4);
location_map.set("Ouzeri Elian",5);
location_map.set("Frydos Autosupply n' More",6);
location_map.set("Coffee Shack",7);
location_map.set("Abila Zacharo",8);
location_map.set("Gelatogalore",9);
location_map.set("Albert's Fine Clothing",10);
location_map.set("Guy's Gyros",11);
location_map.set("Coffee Cameleon",12);
location_map.set("Shoppers' Delight",13);
location_map.set("General Grocer",14);
location_map.set("Octavio's Office Supplies",15);
location_map.set("Bean There Done That",16);
location_map.set("Brewed Awakenings",17);
location_map.set("Jack's Magical Beans",18);
location_map.set("Carlyle Chemical Inc.",19);
location_map.set("Abila Airport",20);
location_map.set("Maximum Iron and Steel",21);
location_map.set("U-Pump",22);
location_map.set("Nationwide Refinery",23);
location_map.set("Stewart and Sons Fabrication",24);
location_map.set("Abila Scrapyard",25);
location_map.set("Frank's Fuel",26);
location_map.set("Chostus Hotel",27);
location_map.set("Ahaggo Museum",28);
location_map.set("Desafio Golf Course",29);
location_map.set("Roberts and Sons",30);
location_map.set("Kronos Mart",31);
location_map.set("Daily Dealz",32);

let range_map = new Map();
range_map.set("0-2",0);
range_map.set("2-4",1);
range_map.set("4-6",2);
range_map.set("6-8",3);
range_map.set("8-10",4);
range_map.set("10-12",5);
range_map.set("12-14",6);
range_map.set("14-16",7);
range_map.set("16-18",8);
range_map.set("18-20",9);
range_map.set("20-22",10);
range_map.set("22-24",11);

let day_map = new Map();
day_map.set("2014-01-06",0);
day_map.set("2014-01-07",1);
day_map.set("2014-01-08",2);
day_map.set("2014-01-09",3);
day_map.set("2014-01-10",4);
day_map.set("2014-01-11",5);
day_map.set("2014-01-12",6);
day_map.set("2014-01-13",7);
day_map.set("2014-01-14",8);
day_map.set("2014-01-15",9);
day_map.set("2014-01-16",10);
day_map.set("2014-01-17",11);
day_map.set("2014-01-18",12);
day_map.set("2014-01-19",13);

function getIndex(key,map) {
  return map.get(key);
}

let unique_loc = [];
location_map.forEach((value, key) => { unique_loc.push(key) } )
const xValues = unique_loc;
let yValues;
let zValues;

yValues  = ['06/01', '07/01', '08/01', '09/01','10/01','11/01','12/01','13/01','14/01','15/01','16/01','17/01', '18/01', '19/01'];
zValues  = [
    [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
    [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
    [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
    [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
    [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
    [0, 0, 0, 0, 0,0.00, 0., 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
    [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
    [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
    [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
    [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
    [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
    [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
    [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
    [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00]
  ]

function formatY(htElement) {
  console.log("element", htElement);
  switch (htElement){
    case '06/01':
      htElement = '2014-01-06';
      return htElement;
    case '07/01':
      htElement = '2014-01-07';
      return htElement;
    case '08/01':
      htElement = '2014-01-08';
      return htElement;
    case '09/01':
      htElement = '2014-01-09';
      return htElement;
    case '10/01':
      htElement = '2014-01-10';
      return htElement;
    case '11/01':
      htElement = '2014-01-11';
      return htElement;
    case '12/01':
      htElement = '2014-01-12';
      return htElement;
    case '13/01':
      htElement = '2014-01-13';
      return htElement;
    case '14/01':
      htElement = '2014-01-14';
      return htElement;
    case '15/01':
      htElement = '2014-01-15';
      return htElement;
    case '16/01':
      htElement = '2014-01-16';
      return htElement;
    case '17/01':
      htElement = '2014-01-17';
      return htElement;
    case '18/01':
      htElement = '2014-01-18';
      return htElement;
    case '19/01':
      htElement = '2014-01-19';
      return htElement;
    case '0- 2':
      return '0-2';
    case '2- 4':
      console.log("sono 2 4 ")
      return '2-4';
    case '4- 6':
      return '4-6';
    case '6- 8':
      return '6-8';
    case '8- 10':
      return '8-10'
    case '10- 12':
      return  '10-12'
    case '12- 14':
      return  '12-14'
    case '14- 16':
      return  '14-16'
    case '16- 18':
      return  '16-18'
    case '18- 20':
      return '18-20'
    case '20- 22':
      return  '20-22'
    case '22- 24':
      return '22-24'
  }
}

export default {
  name: 'Heatmap',
  components: {
    VuePlotly
  },
  props:{
    matrix_loc: Map,
  },
  data() {
    return {
      data: [{
        x: xValues,
        y: yValues,
        z: zValues,
        type: 'heatmap',
        colorscale: 'Portland',
        colorbar: {orientation:180, len: 1.1},
        hoverongaps: false
      },
      ],
      layout: {
        height: 550,
        width: 650,
        title: '',
        annotations: [],
        margin: {
          l: -2,
          t: 5,
        },
        xaxis: {
          height: 100,
          ticks: { height: 500},
          side: 'bottom',
          automargin: true
      },
        yaxis: {
          ticks: '',
          ticksuffix: ' ',
          side:"left"
        },
      },
      options: {
        displayModeBar: false
      }
    }
  },
  watch: {
    matrix_loc: {
      handler(matrix_loc){
        console.log("Heatmp",matrix_loc);
        let z_values;
        let y_values;
        if(matrix_loc.size==14){
          y_values = ['06/01', '07/01', '08/01', '09/01','10/01','11/01','12/01','13/01','14/01','15/01','16/01','17/01', '18/01', '19/01'];
          z_values =  [
            [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
            [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
            [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
            [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
            [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
            [0, 0, 0, 0, 0,0.00, 0., 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
            [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
            [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
            [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
            [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
            [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
            [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
            [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
            [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00]
          ];
        }else{
          y_values = ['0- 2', '2- 4', '4- 6', '6- 8','8- 10','10- 12','12- 14','14- 16','16- 18','18- 20','20- 22','22- 24'];
          z_values =  [
            [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
            [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
            [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
            [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
            [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
            [0, 0, 0, 0, 0,0.00, 0., 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
            [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
            [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
            [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
            [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
            [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
            [0, 0, 0, 0, 0,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00,0.00, 0.00, 0.00,0.00, 0, 0.00, 0.00, 0.00, 0.00, 0.00],
          ];
        }
        console.log("z values",z_values);
        matrix_loc.forEach((submap, range) => {
          console.log("matrix",matrix_loc);
          submap.forEach((price, loc) => {
            let index_loc = getIndex(loc,location_map);
            let index_rg;
            if(matrix_loc.size==14){
              index_rg = getIndex(range,day_map);
            }
            else
              index_rg = getIndex(range,range_map);
            z_values[index_rg][index_loc] = price;
          } )
        } )
        this.data[0].y = y_values;
        this.data[0].z = z_values;
        console.log("y and z", this.data[0].y, this.data[0].z);
      },
      immediate: true
    },
    deep: true
  },
  methods: {
    triggerClick (value) {
      console.log("value click heat", value.points[0].x,value.points[0].y);
      let ht = {"x": value.points[0].x, "y" : value.points[0].y};
      console.log("ht",ht)
      ht["y"] = formatY(ht["y"]);
      console.log("ht",ht)
      this.$emit('get-heatmap', ht);
    }
  },
}
</script>

<style scoped>
.HeatMap{
  height: 600px;
  width: 500px;
}
</style>
